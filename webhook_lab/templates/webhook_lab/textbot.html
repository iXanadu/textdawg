{% extends "main/base.html" %}
{% block extra_styles %}
    <style>
        #chat-display {
            height: 300px;
            overflow-y: auto;
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            padding: 15px;
            margin-bottom: 15px;
        }
        .message {
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 10px;
        }
        .user-message {
            background-color: #d1ecf1;
            text-align: right;
        }
        .response-message {
            background-color: #d4edda;
        }
        .chat-input {
            padding: 0;
        }
    <style>
{% endblock %}
{% block content %}
<div class="login-container">
    <div class="container mt-4">
        <div id="chat-display">
            <!-- Messages will be appended here -->
        </div>
        <div class="chat-input">
            <input type="tel" id="phone-number" class="form-control mb-2" value="{{ phone_number }}">
            <textarea id="user-input" class="form-control mb-2" placeholder="Enter your message" onkeypress="handleKeyPress(event)"></textarea>
            <button id="send-button" class="btn btn-primary">Send</button>
        </div>
    </div>

    <!-- jQuery (Full version) -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- JavaScript for AJAX calls and chat functionality -->
    <script>
        function handleKeyPress(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                sendMessage();
            }
        }

        function generateRandomID(length) {
            var result = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        }

        function sendMessage() {
            var phoneNumber = $("#phone-number").val().trim();
            var userInput = $("#user-input").val().trim();

            if (!phoneNumber || !userInput) {
                alert("Both phone number and message are required.");
                return;
            }
            if (!phoneNumber.startsWith('+1')) {
                phoneNumber = '+1' + phoneNumber;
            }
            // Add user message to chat display
            $("#chat-display").append("<div class='message user-message'>" + userInput + "</div>");
            $("#chat-display").scrollTop($("#chat-display")[0].scrollHeight);

            $.ajax({
                url: '/webhook/smsweb_receiver/', // Your webhook URL
                type: 'POST',
                contentType: 'application/x-www-form-urlencoded',
                data: {
                    ToCountry: 'US',
                    ToState: 'VA',
                    SmsMessageSid: generateRandomID(34),
                    NumMedia: '0',
                    ToCity: 'CHESAPEAKE',
                    FromZip: '23708',
                    SmsSid: generateRandomID(34),
                    FromState: 'VA',
                    SmsStatus: 'received',
                    FromCity: 'NORFOLK',
                    Body: userInput,
                    FromCountry: 'US',
                    To: '+17579083929', // Placeholder, replace with actual
                    ToZip: '23320',
                    NumSegments: '1',
                    MessageSid: generateRandomID(34),
                    AccountSid: 'AC7f9ebf704092eb721560e3755b41c9cd', // Placeholder, replace with actual
                    From: phoneNumber,
                    ApiVersion: '2010-04-01'
                },
                success: function(response) {
                    console.log("Response received:", response);
                    $("#chat-display").append("<div class='message response-message'>Server: " + response + "</div>");
                    $("#chat-display").scrollTop($("#chat-display")[0].scrollHeight);
                },
                error: function(xhr, status, error) {
                    console.error("Error occurred:", status, error);
                    alert("Error sending message: " + error);
                }
            });

            // Clear the input field after sending
            $("#user-input").val('');
        }

        $(document).ready(function() {
            $("#send-button").click(sendMessage);
        });
    </script>
</div>
{% endblock %}



{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <!-- Bootstrap CSS -->#}
{#    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">#}
{#    <title>Chatbot Test</title>#}
{#    <!-- Custom CSS for styling -->#}
{#    <style>#}
{#        body {#}
{#            background-color: #f8f9fa;#}
{#        }#}
{#        #chat-display {#}
{#            height: 300px;#}
{#            overflow-y: auto;#}
{#            background-color: #fff;#}
{#            border: 1px solid #dee2e6;#}
{#            border-radius: 0.25rem;#}
{#            padding: 15px;#}
{#            margin-bottom: 15px;#}
{#        }#}
{#        .message {#}
{#            padding: 10px;#}
{#            margin-bottom: 5px;#}
{#            border-radius: 10px;#}
{#        }#}
{#        .user-message {#}
{#            background-color: #d1ecf1;#}
{#            text-align: right;#}
{#        }#}
{#        .response-message {#}
{#            background-color: #d4edda;#}
{#        }#}
{#        .chat-input {#}
{#            padding: 0;#}
{#        }#}
{#    </style>#}
{#</head>#}
{#<body>#}
{#    <div class="container mt-4">#}
{#        <div id="chat-display">#}
{#            <!-- Messages will be appended here -->#}
{#        </div>#}
{#        <div class="chat-input">#}
{#            <input type="tel" id="phone-number" class="form-control mb-2" placeholder="Enter phone number">#}
{#            <textarea id="user-input" class="form-control mb-2" placeholder="Enter your message" onkeypress="handleKeyPress(event)"></textarea>#}
{#            <button id="send-button" class="btn btn-primary">Send</button>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- jQuery (Full version) -->#}
{#    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>#}
{##}
{#    <!-- Bootstrap JS and Popper.js -->#}
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>#}
{#    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>#}
{##}
{#    <!-- JavaScript for AJAX calls and chat functionality -->#}
{#    <script>#}
{#        function handleKeyPress(event) {#}
{#            if (event.keyCode === 13) {#}
{#                event.preventDefault();#}
{#                sendMessage();#}
{#            }#}
{#        }#}
{##}
{#        function generateRandomID(length) {#}
{#            var result = '';#}
{#            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';#}
{#            var charactersLength = characters.length;#}
{#            for (var i = 0; i < length; i++) {#}
{#                result += characters.charAt(Math.floor(Math.random() * charactersLength));#}
{#            }#}
{#            return result;#}
{#        }#}
{##}
{#        function sendMessage() {#}
{#            var phoneNumber = $("#phone-number").val().trim();#}
{#            var userInput = $("#user-input").val().trim();#}
{##}
{#            if (!phoneNumber || !userInput) {#}
{#                alert("Both phone number and message are required.");#}
{#                return;#}
{#            }#}
{#            if (!phoneNumber.startsWith('+1')) {#}
{#                phoneNumber = '+1' + phoneNumber;#}
{#            }#}
{#            // Add user message to chat display#}
{#            $("#chat-display").append("<div class='message user-message'>" + userInput + "</div>");#}
{#            $("#chat-display").scrollTop($("#chat-display")[0].scrollHeight);#}
{##}
{#            $.ajax({#}
{#                url: '/webhook/sms_receiver/', // Your webhook URL#}
{#                type: 'POST',#}
{#                contentType: 'application/x-www-form-urlencoded',#}
{#                data: {#}
{#                    ToCountry: 'US',#}
{#                    ToState: 'VA',#}
{#                    SmsMessageSid: generateRandomID(34),#}
{#                    NumMedia: '0',#}
{#                    ToCity: 'CHESAPEAKE',#}
{#                    FromZip: '23708',#}
{#                    SmsSid: generateRandomID(34),#}
{#                    FromState: 'VA',#}
{#                    SmsStatus: 'received',#}
{#                    FromCity: 'NORFOLK',#}
{#                    Body: userInput,#}
{#                    FromCountry: 'US',#}
{#                    To: '+17579083929', // Placeholder, replace with actual#}
{#                    ToZip: '23320',#}
{#                    NumSegments: '1',#}
{#                    MessageSid: generateRandomID(34),#}
{#                    AccountSid: 'AC7f9ebf704092eb721560e3755b41c9cd', // Placeholder, replace with actual#}
{#                    From: phoneNumber,#}
{#                    ApiVersion: '2010-04-01'#}
{#                },#}
{#                success: function(response) {#}
{#                    console.log("Response received:", response);#}
{#                    $("#chat-display").append("<div class='message response-message'>Server: " + response.status + "</div>");#}
{#                    $("#chat-display").scrollTop($("#chat-display")[0].scrollHeight);#}
{#                },#}
{#                error: function(xhr, status, error) {#}
{#                    console.error("Error occurred:", status, error);#}
{#                    alert("Error sending message: " + error);#}
{#                }#}
{#            });#}
{##}
{#            // Clear the input field after sending#}
{#            $("#user-input").val('');#}
{#        }#}
{##}
{#        $(document).ready(function() {#}
{#            $("#send-button").click(sendMessage);#}
{#        });#}
{#    </script>#}
{#</body>#}
{#</html>#}
